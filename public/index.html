<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Funeral Home Services - Arrangement Form</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="header-content">
      <h1>üïäÔ∏è Funeral Home Services</h1>
      <p>Professional Funeral Arrangement Form</p>
    </div>
  </header>

  <!-- Main Container -->
  <div class="container">
    <!-- Alert Messages -->
    <div id="alertContainer"></div>

    <!-- Main Form Card -->
    <div class="card">
      <div class="card-header">
        <h2>Service Arrangement Form</h2>
        <p>Please complete all required fields. Our team will contact you within 24 hours to discuss arrangements.</p>
      </div>

      <form id="funeralForm">
        <!-- Deceased Information Section -->
        <div class="form-section">
          <h3 class="section-title">
            <span class="section-icon">üë§</span>
            Deceased Information
          </h3>
          <div class="form-grid">
            <div class="form-group">
              <label for="deceased_first_name">First Name <span class="required">*</span></label>
              <input type="text" id="deceased_first_name" name="deceased_first_name" required>
            </div>
            <div class="form-group">
              <label for="deceased_last_name">Last Name <span class="required">*</span></label>
              <input type="text" id="deceased_last_name" name="deceased_last_name" required>
            </div>
            <div class="form-group">
              <label for="deceased_dob">Date of Birth <span class="required">*</span></label>
              <input type="date" id="deceased_dob" name="deceased_dob" required>
            </div>
            <div class="form-group">
              <label for="deceased_dod">Date of Death <span class="required">*</span></label>
              <input type="date" id="deceased_dod" name="deceased_dod" required>
            </div>
            <div class="form-group">
              <label for="deceased_ssn">Social Security Number</label>
              <input type="text" id="deceased_ssn" name="deceased_ssn" placeholder="XXX-XX-XXXX" pattern="\d{3}-\d{2}-\d{4}">
              <small>Format: XXX-XX-XXXX (Optional but helpful for documentation)</small>
            </div>
            <div class="form-group">
              <label for="veteran_status">Veteran Status</label>
              <select id="veteran_status" name="veteran_status">
                <option value="">Select status</option>
                <option value="none">Not a Veteran</option>
                <option value="army">U.S. Army</option>
                <option value="navy">U.S. Navy</option>
                <option value="air_force">U.S. Air Force</option>
                <option value="marines">U.S. Marines</option>
                <option value="coast_guard">U.S. Coast Guard</option>
                <option value="national_guard">National Guard</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Service Preferences Section -->
        <div class="form-section">
          <h3 class="section-title">
            <span class="section-icon">‚õ™</span>
            Service Preferences
          </h3>
          <div class="form-grid">
            <div class="form-group">
              <label for="service_type">Type of Service <span class="required">*</span></label>
              <select id="service_type" name="service_type" required>
                <option value="">Select service type</option>
                <option value="traditional">Traditional Funeral Service</option>
                <option value="memorial">Memorial Service</option>
                <option value="graveside">Graveside Service</option>
                <option value="celebration">Celebration of Life</option>
                <option value="direct">Direct Burial/Cremation</option>
                <option value="viewing">Viewing/Visitation Only</option>
              </select>
            </div>
            <div class="form-group">
              <label for="service_date">Preferred Service Date</label>
              <input type="date" id="service_date" name="service_date">
            </div>
            <div class="form-group">
              <label for="service_time">Preferred Service Time</label>
              <input type="time" id="service_time" name="service_time">
            </div>
            <div class="form-group">
              <label for="service_location">Service Location</label>
              <input type="text" id="service_location" name="service_location" placeholder="Church, funeral home, or other venue">
            </div>
            <div class="form-group">
              <label for="religious_preference">Religious Preference</label>
              <input type="text" id="religious_preference" name="religious_preference" placeholder="e.g., Catholic, Protestant, Jewish, Muslim, None">
            </div>
          </div>

          <div class="form-group mt-3">
            <label>Final Disposition <span class="required">*</span></label>
            <div class="radio-group">
              <div class="radio-option">
                <input type="radio" id="burial" name="burial_cremation" value="burial" required>
                <label for="burial">Burial</label>
              </div>
              <div class="radio-option">
                <input type="radio" id="cremation" name="burial_cremation" value="cremation" required>
                <label for="cremation">Cremation</label>
              </div>
              <div class="radio-option">
                <input type="radio" id="undecided" name="burial_cremation" value="undecided" required>
                <label for="undecided">Undecided</label>
              </div>
            </div>
          </div>
        </div>

        <!-- Contact Information Section -->
        <div class="form-section">
          <h3 class="section-title">
            <span class="section-icon">üìû</span>
            Contact Information
          </h3>
          <div class="form-grid">
            <div class="form-group">
              <label for="contact_first_name">Your First Name <span class="required">*</span></label>
              <input type="text" id="contact_first_name" name="contact_first_name" required>
            </div>
            <div class="form-group">
              <label for="contact_last_name">Your Last Name <span class="required">*</span></label>
              <input type="text" id="contact_last_name" name="contact_last_name" required>
            </div>
            <div class="form-group">
              <label for="contact_phone">Phone Number <span class="required">*</span></label>
              <input type="tel" id="contact_phone" name="contact_phone" placeholder="(555) 123-4567" required>
            </div>
            <div class="form-group">
              <label for="contact_email">Email Address <span class="required">*</span></label>
              <input type="email" id="contact_email" name="contact_email" placeholder="your.email@example.com" required>
            </div>
            <div class="form-group">
              <label for="contact_relationship">Relationship to Deceased <span class="required">*</span></label>
              <select id="contact_relationship" name="contact_relationship" required>
                <option value="">Select relationship</option>
                <option value="spouse">Spouse</option>
                <option value="child">Child</option>
                <option value="parent">Parent</option>
                <option value="sibling">Sibling</option>
                <option value="other_family">Other Family Member</option>
                <option value="friend">Friend</option>
                <option value="executor">Executor/Legal Representative</option>
                <option value="other">Other</option>
              </select>
            </div>
          </div>

          <div class="form-grid mt-3">
            <div class="form-group">
              <label for="contact_address">Street Address</label>
              <input type="text" id="contact_address" name="contact_address" placeholder="123 Main Street">
            </div>
            <div class="form-group">
              <label for="contact_city">City</label>
              <input type="text" id="contact_city" name="contact_city">
            </div>
            <div class="form-group">
              <label for="contact_state">State</label>
              <input type="text" id="contact_state" name="contact_state" placeholder="CA" maxlength="2">
            </div>
            <div class="form-group">
              <label for="contact_zip">ZIP Code</label>
              <input type="text" id="contact_zip" name="contact_zip" placeholder="12345" pattern="\d{5}">
            </div>
          </div>
        </div>

        <!-- Obituary and Additional Information Section -->
        <div class="form-section">
          <h3 class="section-title">
            <span class="section-icon">üìù</span>
            Additional Information
          </h3>
          <div class="form-group">
            <label for="obituary_text">Obituary Text</label>
            <textarea id="obituary_text" name="obituary_text" placeholder="Please provide any obituary text or biographical information you'd like to include..."></textarea>
            <small>This information will be used for the obituary and service program</small>
          </div>
          <div class="form-group">
            <label for="additional_notes">Special Requests or Additional Notes</label>
            <textarea id="additional_notes" name="additional_notes" placeholder="Please share any special requests, preferences, or additional information that would help us serve you better..."></textarea>
          </div>
        </div>

        <!-- Submit Button -->
        <div class="form-group">
          <button type="submit" class="btn btn-primary btn-block" id="submitBtn">
            <span id="submitText">Submit Arrangement Request</span>
            <span id="submitSpinner" class="spinner hidden"></span>
          </button>
        </div>

        <p class="text-center" style="color: var(--text-muted); font-size: 0.875rem; margin-top: 1rem;">
          By submitting this form, you acknowledge that the information provided is accurate and complete to the best of your knowledge.
        </p>
      </form>
    </div>

    <!-- Admin Link -->
    <div class="text-center mt-4">
      <a href="/admin" class="btn btn-secondary">
        üìä View Admin Dashboard
      </a>
    </div>
  </div>

  <script>
    const form = document.getElementById('funeralForm');
    const submitBtn = document.getElementById('submitBtn');
    const submitText = document.getElementById('submitText');
    const submitSpinner = document.getElementById('submitSpinner');
    const alertContainer = document.getElementById('alertContainer');

    // Form submission handler
    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      // Disable submit button
      submitBtn.disabled = true;
      submitText.textContent = 'Submitting...';
      submitSpinner.classList.remove('hidden');

      // Collect form data
      const formData = new FormData(form);
      const data = Object.fromEntries(formData.entries());

      try {
        const response = await fetch('/api/submit', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data),
        });

        const result = await response.json();

        if (result.success) {
          showAlert('success', 'Thank you for submitting your arrangement request. Our team will contact you within 24 hours.');
          form.reset();
          window.scrollTo({ top: 0, behavior: 'smooth' });
        } else {
          showAlert('error', 'There was an error submitting your form. Please try again or contact us directly.');
        }
      } catch (error) {
        console.error('Error:', error);
        showAlert('error', 'There was an error submitting your form. Please check your connection and try again.');
      } finally {
        // Re-enable submit button
        submitBtn.disabled = false;
        submitText.textContent = 'Submit Arrangement Request';
        submitSpinner.classList.add('hidden');
      }
    });

    // Show alert message
    function showAlert(type, message) {
      const alertClass = type === 'success' ? 'alert-success' : 'alert-error';
      const icon = type === 'success' ? '‚úì' : '‚úï';
      
      const alert = document.createElement('div');
      alert.className = `alert ${alertClass}`;
      alert.innerHTML = `<span style="font-size: 1.25rem;">${icon}</span><span>${message}</span>`;
      
      alertContainer.innerHTML = '';
      alertContainer.appendChild(alert);

      // Auto-remove after 5 seconds
      setTimeout(() => {
        alert.remove();
      }, 5000);
    }

    // Date validation
    const dobInput = document.getElementById('deceased_dob');
    const dodInput = document.getElementById('deceased_dod');
    const serviceDateInput = document.getElementById('service_date');

    // Set max date for DOB (today)
    const today = new Date().toISOString().split('T')[0];
    dobInput.max = today;
    dodInput.max = today;

    // Set min date for service date (today)
    serviceDateInput.min = today;

    // Validate DOD is after DOB
    dodInput.addEventListener('change', () => {
      if (dobInput.value && dodInput.value) {
        if (new Date(dodInput.value) < new Date(dobInput.value)) {
          dodInput.setCustomValidity('Date of death must be after date of birth');
        } else {
          dodInput.setCustomValidity('');
        }
      }
    });

    // Format SSN input
    const ssnInput = document.getElementById('deceased_ssn');
    ssnInput.addEventListener('input', (e) => {
      let value = e.target.value.replace(/\D/g, '');
      if (value.length > 3 && value.length <= 5) {
        value = value.slice(0, 3) + '-' + value.slice(3);
      } else if (value.length > 5) {
        value = value.slice(0, 3) + '-' + value.slice(3, 5) + '-' + value.slice(5, 9);
      }
      e.target.value = value;
    });

    // Format phone input
    const phoneInput = document.getElementById('contact_phone');
    phoneInput.addEventListener('input', (e) => {
      let value = e.target.value.replace(/\D/g, '');
      if (value.length > 0) {
        if (value.length <= 3) {
          value = '(' + value;
        } else if (value.length <= 6) {
          value = '(' + value.slice(0, 3) + ') ' + value.slice(3);
        } else {
          value = '(' + value.slice(0, 3) + ') ' + value.slice(3, 6) + '-' + value.slice(6, 10);
        }
      }
      e.target.value = value;
    });
  </script>
</body>
</html>
